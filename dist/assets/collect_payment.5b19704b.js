import{d as xe,a as h,u as x,b as Ce,r as y,p as Se,c as Fe,e as ne,o as Pe,f as F,H as J,g as Te,h as m,i as w,j as l,k as t,w as a,l as c,m as e,_ as P,n as W,q as b,T as v,F as M,s as L,t as T,v as g,D as _,P as X,z as U,L as $e,x as le,$ as ie,a0 as de,B as Ie,I as N,C as De,E as Y,G as Z,O as ee}from"./index.62cb36ac.js";import{_ as G}from"./FileIcon.vue_vue_type_script_setup_true_lang.9c6a0f59.js";const te="http://garage_api.test/api/",Be=xe({id:"usePaymentStore",state:()=>({ItemDetail:[],ItemEdit:[],Currency:[],PaymentType:[],Project:[],docFile:[]}),getters:{getItemsDetail(s){return s.ItemDetail},getItemsById(s){return s.ItemEdit},getCurrency(s){return s.Currency},getType(s){return s.PaymentType},getProject(s){return s.Project},getQuote_File(s){return s.docFile}},actions:{async payment_file_view(s){await h.get(`v1/somnong/payment_file/${s}`).then(async r=>(this.docFile=r.data.data,this.docFile)).catch(r=>{if(r.response&&r.response.data){const u=r.response.data;x().setErrors(u.errors)}})},async somnong_referent(){await h.get("v1/somnong/combo/somnong_referent").then(s=>{this.Project=s.data.data}).catch(s=>{if(s.response&&s.response.data){const r=s.response.data;x().setErrors(r.errors)}})},async somnong_currency(){await h.get("v1/somnong/combo/base_currency").then(s=>{this.Currency=s.data.data}).catch(s=>{if(s.response&&s.response.data){const r=s.response.data;x().setErrors(r.errors)}})},async somnong_type(){await h.get("v1/somnong/combo/somnong_type").then(s=>{this.PaymentType=s.data.data}).catch(s=>{if(s.response&&s.response.data){const r=s.response.data;x().setErrors(r.errors)}})},async ItemsList(){await h.get("v1/somnong/getPayment").then(s=>{s.data.success&&(this.ItemDetail=s.data.data)}).catch(s=>{if(s.response&&s.response.data){const r=s.response.data;x().setErrors(r.errors)}})},async ItemsById(s){await h.get(`v1/somnong/somnong_payment/${s}`).then(r=>{if(r.data.success)return this.ItemEdit=r.data.data,this.ItemEdit})},async create(s){return await h.post(te+"v1/somnong/somnong_payment",s).then(async r=>{if(r.data.success)return r.data.success}).catch(r=>{if(r.response&&r.response.data){const u=r.response.data;x().setErrors(u.errors)}})},async upload_image(s,r){let u=new FormData;return u.append("referent_id",r),u.append("name",s.name),u.append("image",s),u.append("description",r),await h.post(te+"v1/somnong/payment_upload_file",u).then(async f=>{if(f.data.success)return this.quote_file_view(r),f.data.success}).catch(f=>{if(f.response&&f.response.data){const A=f.response.data;x().setErrors(A.errors)}})},async quote_file_view(s){await h.get(`v1/somnong/payment_file/${s}`).then(async r=>(this.docFile=r.data.data,this.docFile)).catch(r=>{if(r.response&&r.response.data){const u=r.response.data;x().setErrors(u.errors)}})},async del_quote_file(s){return await h.post(te+"v1/somnong/del_payment_file",s).then(async r=>{if(r.data.success)return r.data.success}).catch(r=>{if(r.response&&r.response.data){const u=r.response.data;x().setErrors(u.errors)}})}}}),Ee={class:"grid grid-cols-12 gap-6 mt-5"},Ve={class:"flex flex-wrap items-center col-span-12 mt-2 intro-y sm:flex-nowrap"},qe=l("div",{class:"hidden mx-auto md:block text-slate-500"}," Showing 1 to 10 of 150 entries ",-1),je={class:"w-full mt-3 sm:w-auto sm:mt-0 sm:ml-auto md:ml-0"},Me={class:"relative w-56 text-slate-500"},Le={class:"col-span-12 overflow-auto intro-y lg:overflow-visible"},Ue={href:"",class:"font-medium whitespace-nowrap"},Ne={class:"text-slate-500 text-xs whitespace-nowrap mt-0.5"},Ae={class:"flex items-center justify-center"},ze=["onClick"],Re=["onClick"],Qe={class:"text-center"},He=l("h2",{class:"mr-auto text-base font-medium"}," Income / Expense ",-1),Oe={class:"col-span-12 sm:col-span-12"},Xe=["value"],Ge={class:"col-span-12 sm:col-span-6"},Ke=["disabled","error"],Je=["value"],We={class:"col-span-12 sm:col-span-6"},Ye=["disabled"],Ze=["value"],et={class:"col-span-12 sm:col-span-6"},tt={class:"col-span-12 sm:col-span-12"},at={class:"text-center"},st={class:"p-5"},ot=l("h2",{class:"mr-auto text-base font-medium"}," File Documents ",-1),rt={class:"col-span-12 intro-y lg:col-span-12"},nt={class:"flex items-center"},lt={class:"ml-4"},it={class:"font-medium",href:""},dt={class:"text-slate-500 text-xs mt-0.5"},ct={class:"p-5 text-center"},ut=l("div",{class:"mt-5 text-3xl"},"Are you sure to delete ?",-1),mt={class:"mt-2 text-slate-500"},pt={class:"px-5 pb-8 text-center"},_t={class:"ml-4 mr-4"},ft={class:"font-medium"},gt=Ce({__name:"collect_payment",setup(s){const r=y(!1),u=y(),f=y(!1),A=y(!1),ae=y(null),z=d=>{A.value=d},K=()=>{var d;(d=u.value)==null||d.showToast()};Se("bind[basicStickyNotification]",d=>{u.value=d});const E=d=>{r.value=d},ce=d=>{H(),r.value=d},V=d=>{f.value=d},p=Be(),se=Fe(),i=ne({}),q=ne({}),j=y(""),R=y(""),$=y(""),I=y(""),D=y("");y(null);const C=y(!0),Q=y(!0);Pe(async()=>{H(),await p.somnong_currency(),await p.somnong_type(),await p.somnong_referent(),await p.ItemsList()});const ue=F(()=>p.getCurrency),me=F(()=>p.getType),pe=F(()=>p.getProject),_e=F(()=>p.getItemsDetail),S=F(()=>p.getItemsById),oe=F(()=>p.getQuote_File);J($,()=>{i.currency_code=$.value}),J(I,()=>{i.type_code=I.value}),J(D,()=>{i.referent_code=D.value,i.referent_code!=""&&Q.value==!1?C.value=!1:C.value=!0});function H(){i.branch_code="",i.amount=0,i.currency="",i.currency_code="",i.ref_exchange="",i.is_update=!0,i.status="i",$.value="",D.value="",I.value="",k.value.$reset,C.value=!0,Q.value=!1}const fe=F(()=>({currency_code:{required:Y.withMessage("Quote status is required",Z),minLength:ee(1)},type_code:{required:Y.withMessage("Client information is required",Z),minLength:ee(1)},referent_code:{required:Y.withMessage("Quote status is required",Z),minLength:ee(1)}})),k=Te(fe,i,{$autoDirty:!0});async function ye(){if(k.value.$touch(),k.value.$invalid)j.value=k.value.$errors[0].$message,R.value="error",K();else{var d=await p.create(i);d&&(R.value="",i.status=="i"?j.value=se.getInsert:j.value=se.getUpdate,K(),H(),p.ItemsList(),E(!1))}}async function re(d){i.payment_id=d,p.payment_file_view(d),V(!0)}async function ve(d){H(),await p.ItemsById(d),i.status="u",i.payment_id=S.value[0].payment_id,i.remark=S.value[0].remark,i.amount=S.value[0].amount,D.value=S.value[0].referent_code,$.value=S.value[0].currency_code,I.value=S.value[0].type_code,i.is_update=S.value[0].is_update,i.is_update==!1&&(C.value=!0,Q.value=!0),E(!0)}const O=y([]),ge=()=>O.value=[],be=d=>{const n=d.target;n.files!==null&&(ge(),Array.from(n.files).forEach(o=>{O.value.push({referent_id:i.payment_id,file:o,percentage:0,status:"pending",size:o.size})}),O.value[0].size>5e5?(j.value="File bigger than 2MB !!!",R.value="error",K()):O.value.forEach(o=>{o.status="uploading",o.percentage=0,p.upload_image(o.file,i.payment_id)}))};async function he(d){q.file_code=d}async function we(d){}async function ke(d){q.status="del_payment_file",q.quote_code=i.payment_id;var n=await p.del_quote_file(q);n&&(V(!1),z(!1),re(i.payment_id))}return(d,n)=>(m(),w("div",Ee,[l("div",Ve,[t(e(P),{variant:"primary",class:"mr-2 shadow-md",onClick:n[0]||(n[0]=()=>{ce(!0)})},{default:a(()=>[c(" Create New ")]),_:1}),qe,l("div",je,[l("div",Me,[t(e(W),{type:"text",class:"w-56 pr-10 !box",placeholder:"Search..."}),t(e(b),{icon:"Search",class:"absolute inset-y-0 right-0 w-4 h-4 my-auto mr-3"})])])]),l("div",Le,[t(e(v),{class:"border-spacing-y-[10px] border-separate -mt-2"},{default:a(()=>[t(e(v).Thead,null,{default:a(()=>[t(e(v).Tr,null,{default:a(()=>[t(e(v).Th,{class:"border-b-0 whitespace-nowrap"},{default:a(()=>[c(" Customer name ")]),_:1}),t(e(v).Th,{class:"border-b-0 whitespace-nowrap"},{default:a(()=>[c(" Amount ")]),_:1}),t(e(v).Th,{class:"border-b-0 whitespace-nowrap"},{default:a(()=>[c(" Remark ")]),_:1}),t(e(v).Th,{class:"text-center border-b-0 whitespace-nowrap"},{default:a(()=>[c(" STATUS ")]),_:1})]),_:1})]),_:1}),t(e(v).Tbody,null,{default:a(()=>[(m(!0),w(M,null,L(_e.value,o=>(m(),T(e(v).Tr,{key:o.payment_id,class:"intro-x"},{default:a(()=>[t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b]"},{default:a(()=>[l("a",Ue,g(o.title),1),l("div",Ne," id: "+g(o.payment_id)+"-"+g(o.tran_type),1)]),_:2},1024),t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b]"},{default:a(()=>[c(g(o.currency)+" "+g(o.amount),1)]),_:2},1024),t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b]"},{default:a(()=>[c(g(o.remark),1)]),_:2},1024),t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md w-56 bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b] py-0 relative before:block before:w-px before:h-8 before:bg-slate-200 before:absolute before:left-0 before:inset-y-0 before:my-auto before:dark:bg-darkmode-400"},{default:a(()=>[l("div",Ae,[l("a",{class:"flex items-center mr-3",href:"",onClick:B=>{B.preventDefault(),ve(o.payment_id)}},[t(e(b),{icon:"Edit",class:"w-4 h-4 mr-1"}),c(" Edit ")],8,ze),l("a",{class:"flex items-center mr-3",href:"",onClick:B=>{B.preventDefault(),re(o.payment_id)}},[t(e(b),{icon:"Settings",color:"red",class:"w-4 h-4 mr-1"}),c(" File ")],8,Re)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),t(e(_),{staticBackdrop:"",open:r.value,onClose:n[9]||(n[9]=()=>{E(!1)})},{default:a(()=>[t(e(_).Panel,{class:"px-5 py-10"},{default:a(()=>[l("div",Qe,[t(e(X),{class:"mt-5 intro-y box"},{default:a(()=>[t(e(X).Panel,null,{default:a(()=>[t(e(_),{staticBackdrop:"",open:r.value,onClose:n[8]||(n[8]=()=>{E(!1)})},{default:a(()=>[t(e(_).Panel,null,{default:a(()=>[t(e(_).Title,null,{default:a(()=>[He]),_:1}),t(e(_).Description,{class:"grid grid-cols-12 gap-4 gap-y-3"},{default:a(()=>[l("div",Oe,[t(e(U),{htmlFor:"modal-form-1"},{default:a(()=>[c("Project Referent")]),_:1}),t(e($e),{name:"cboClient",modelValue:D.value,"onUpdate:modelValue":n[1]||(n[1]=o=>D.value=o),disabled:Q.value,error:e(k).referent_code.$error,class:le({"border-danger":e(k).referent_code.$error})},{default:a(()=>[(m(!0),w(M,null,L(pe.value,o=>(m(),w("option",{value:o.id,key:o.id},g(o.name),9,Xe))),128))]),_:1},8,["modelValue","disabled","error","class"])]),l("div",Ge,[t(e(U),{htmlFor:"modal-form-1"},{default:a(()=>[c("Currency")]),_:1}),ie(l("select",{id:"small","onUpdate:modelValue":n[2]||(n[2]=o=>$.value=o),class:le(["block w-full p-2 mb-1 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",{"border-danger":e(k).currency_code.$error}]),disabled:C.value,error:e(k).currency_code.$error},[(m(!0),w(M,null,L(ue.value,o=>(m(),w("option",{value:o.id,key:o.id},g(o.name),9,Je))),128))],10,Ke),[[de,$.value]])]),l("div",We,[t(e(U),{htmlFor:"modal-form-1"},{default:a(()=>[c("Type")]),_:1}),ie(l("select",{id:"small","onUpdate:modelValue":n[3]||(n[3]=o=>I.value=o),class:"block w-full p-2 mb-1 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",disabled:C.value},[(m(!0),w(M,null,L(me.value,o=>(m(),w("option",{value:o.id,key:o.id},g(o.name),9,Ze))),128))],8,Ye),[[de,I.value]])]),l("div",et,[t(e(U),{htmlFor:"modal-form-4"},{default:a(()=>[c("Amount ")]),_:1}),t(e(W),{type:"number",value:i.amount,disabled:C.value,placeholder:"Amount",modelValue:i.amount,"onUpdate:modelValue":n[4]||(n[4]=o=>i.amount=o)},null,8,["value","disabled","modelValue"])]),l("div",tt,[t(e(U),{htmlFor:"remark"},{default:a(()=>[c(" Remark ")]),_:1}),t(e(Ie),{modelValue:i.remark,"onUpdate:modelValue":n[5]||(n[5]=o=>i.remark=o),value:i.remark,placeholder:"type your comment"},null,8,["modelValue","value"])])]),_:1}),t(e(_).Footer,null,{default:a(()=>[t(e(P),{type:"button",variant:"outline-secondary",onClick:n[6]||(n[6]=()=>{E(!1)}),class:"w-20 mr-1"},{default:a(()=>[c(" Cancel ")]),_:1}),t(e(P),{name:"btnOk",variant:"primary",type:"button",class:"w-20",ref:"{sendButtonRef}",disable:e(k).$invalid,onClick:n[7]||(n[7]=o=>ye())},{default:a(()=>[c(" Commit ")]),_:1},8,["disable"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})]),_:1})])]),_:1})]),_:1},8,["open"]),t(e(_),{staticBackdrop:"",open:f.value,onClose:n[12]||(n[12]=()=>{V(!1)})},{default:a(()=>[t(e(_).Panel,{class:"px-5 py-10"},{default:a(()=>[l("div",at,[t(e(X),{class:"mt-5 intro-y box"},{default:a(()=>[l("div",st,[t(e(X).Panel,null,{default:a(()=>[t(e(_),{staticBackdrop:"",open:f.value,onClose:n[11]||(n[11]=()=>{V(!1)})},{default:a(()=>[t(e(_).Panel,null,{default:a(()=>[t(e(_).Title,null,{default:a(()=>[ot]),_:1}),t(e(_).Description,{class:"grid grid-cols-12 gap-4 gap-y-3"},{default:a(()=>[(m(!0),w(M,null,L(oe.value,o=>(m(),w("div",rt,[l("div",nt,[o.extension==".png"?(m(),T(e(G),{key:0,class:"w-12 file",variant:"directory"})):o.extension==".pdf"?(m(),T(e(G),{key:1,class:"w-12 file",variant:"file"})):o.extension==".jpg"?(m(),T(e(G),{key:2,class:"w-12 file",variant:"directory"})):(m(),T(e(G),{key:3,class:"w-12 file",variant:"directory"})),l("div",lt,[l("a",it,g(o.file_name),1),l("div",dt,g(o.extension),1)]),t(e(N),{class:"ml-auto"},{default:a(()=>[t(e(N).Button,{tag:"a",class:"block w-5 h-5",href:"#"},{default:a(()=>[t(e(b),{icon:"MoreHorizontal",class:"w-5 h-5 text-slate-500"})]),_:1}),t(e(N).Items,{class:"w-40"},{default:a(()=>[t(e(N).Item,{onClick:B=>we(o.file_name)},{default:a(()=>[t(e(b),{icon:"Files",class:"w-4 h-4 mr-2"}),c(" View File ")]),_:2},1032,["onClick"]),t(e(N).Item,{variant:"primary",onClick:B=>{B.preventDefault(),z(!0),he(o.row)}},{default:a(()=>[t(e(b),{icon:"Trash",class:"w-4 h-4 mr-2 red",color:"red"}),c(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]))),256))]),_:1}),t(e(_).Footer,null,{default:a(()=>[t(e(P),{type:"button",variant:"outline-secondary",onClick:n[10]||(n[10]=()=>{V(!1)}),class:"mr-1"},{default:a(()=>[t(e(b),{icon:"Save",class:"w-4 h-4 mr-4"}),c(" Close ")]),_:1}),t(e(P),{variant:"primary",type:"button",accept:"image/png, image/jpeg"},{default:a(()=>[t(e(b),{icon:"File",class:"w-4 h-4 mr-4"}),c(" Upload "),t(e(W),{type:"file",class:"absolute right-8 w-20 h-10 opacity-0",accept:"image/png, image/jpeg",onChange:be})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})])]),_:1})])]),_:1})]),_:1},8,["open"]),t(e(_),{open:A.value,onClose:n[15]||(n[15]=()=>{z(!1)}),initialFocus:ae.value},{default:a(()=>[t(e(_).Panel,null,{default:a(()=>[l("div",ct,[t(e(b),{icon:"XCircle",class:"w-16 h-16 mx-auto mt-3 text-danger"}),ut,l("div",mt," document : "+g(q.file_code),1)]),l("div",pt,[t(e(P),{type:"button",variant:"outline-secondary",onClick:n[13]||(n[13]=()=>{z(!1)}),class:"w-24 mr-1"},{default:a(()=>[c(" Cancel ")]),_:1}),t(e(P),{type:"button",variant:"danger",class:"w-24",ref:"{deleteButtonRef}",onClick:n[14]||(n[14]=o=>{o.preventDefault(),ke(oe.value[0].tran_code)})},{default:a(()=>[c(" Delete ")]),_:1},512)])]),_:1})]),_:1},8,["open","initialFocus"]),t(e(De),{refKey:"basicStickyNotification",options:{duration:1500},class:"flex hidden"},{default:a(()=>[R.value=="error"?(m(),T(e(b),{key:0,icon:"XCircle",class:"text-danger"})):(m(),T(e(b),{key:1,icon:"CheckCircle",class:"text-success"})),l("div",_t,[l("div",ft,g(j.value),1)])]),_:1})]))}});export{gt as default};

import{d as Ce,a as x,u as q,b as Se,r as g,p as Fe,R as De,c as Ve,e as ue,o as $e,f as S,H as j,Y as Ie,g as Be,h as _,i as y,j as d,k as t,w as a,l as u,m as e,_ as D,n as A,q as k,T as v,F as L,s as P,t as V,v as h,D as p,P as X,z as C,x as K,L as W,Z as Te,B as Ee,I as z,C as Le,E as Z,G as J,O as ee}from"./index.62cb36ac.js";import{_ as te}from"./FileIcon.vue_vue_type_script_setup_true_lang.9c6a0f59.js";const se="http://garage_api.test/api/",Pe=Ce({id:"useQuoteStore",state:()=>({ItemDetail:[],ItemEdit:[],Client:[],Status:[],Leader:[],Quote_File:[],file:[]}),getters:{getItemsDetail(l){return l.ItemDetail},getItemsById(l){return l.ItemEdit},getClients(l){return l.Client},getStatus(l){return l.Status},getLeader(l){return l.Leader},getQuote_File(l){return l.Quote_File},getFile(l){return l.file}},actions:{async quote_file_view(l){await x.get(`v1/somnong/quote_file/${l}`).then(async r=>(this.Quote_File=r.data.data,this.Quote_File)).catch(r=>{if(r.response&&r.response.data){const c=r.response.data;q().setErrors(c.errors)}})},async upload_image(l,r){let c=new FormData;return c.append("referent_id",r),c.append("name",l.name),c.append("image",l),c.append("description",r),await x.post(se+"v1/somnong/quote_file",c).then(async b=>{if(b.data.success)return this.quote_file_view(r),b.data.success}).catch(b=>{if(b.response&&b.response.data){const $=b.response.data;q().setErrors($.errors)}})},async somnong_client(){await x.get("v1/somnong/clients/somnong_client").then(l=>{this.Client=l.data.data}).catch(l=>{if(l.response&&l.response.data){const r=l.response.data;q().setErrors(r.errors)}})},async somnong_leader(){await x.get("v1/somnong/clients/somnong_staff").then(l=>{this.Leader=l.data.data}).catch(l=>{if(l.response&&l.response.data){const r=l.response.data;q().setErrors(r.errors)}})},async somnong_status(){await x.get("v1/somnong/clients/somnong_status").then(l=>{this.Status=l.data.data}).catch(l=>{if(l.response&&l.response.data){const r=l.response.data;q().setErrors(r.errors)}})},async ItemsById(l){await x.get(`v1/somnong/quotes_byId/${l}`).then(r=>{if(r.data.success)return this.ItemEdit=r.data.data,this.ItemEdit})},async ItemsList(){await x.get("v1/somnong/getQuotation").then(l=>{l.data.success&&(this.ItemDetail=l.data.data)}).catch(l=>{if(l.response&&l.response.data){const r=l.response.data;q().setErrors(r.errors)}})},async create(l){return await x.post(se+"v1/somnong/create_quotation",l).then(async r=>{if(r.data.success)return r.data.success}).catch(r=>{if(r.response&&r.response.data){const c=r.response.data;q().setErrors(c.errors)}})},async quote_download(l){return await x.get(`v1/somnong/somnong_download_quote/${l}`).then(async r=>{console.log(r.data)}).catch(r=>{if(r.response&&r.response.data){const c=r.response.data;q().setErrors(c.errors)}})},async del_quote_file(l){return await x.post(se+"v1/somnong/del_quote_file",l).then(async r=>{if(r.data.success)return r.data.success}).catch(r=>{if(r.response&&r.response.data){const c=r.response.data;q().setErrors(c.errors)}})}}}),Me={class:"grid grid-cols-12 gap-6 mt-5"},Qe={class:"flex flex-wrap items-center col-span-12 mt-2 intro-y sm:flex-nowrap"},Ue=d("div",{class:"hidden mx-auto md:block text-slate-500"}," Showing 1 to 10 of 150 entries ",-1),Ne={class:"w-full mt-3 sm:w-auto sm:mt-0 sm:ml-auto md:ml-0"},je={class:"relative w-56 text-slate-500"},Ae={class:"col-span-12 overflow-auto intro-y lg:overflow-visible"},ze={href:"",class:"font-medium whitespace-nowrap"},Re={class:"text-slate-500 text-xs whitespace-nowrap mt-0.5"},He={class:"flex items-center justify-center"},Ge=["onClick"],Oe=["onClick"],Ye={class:"text-center"},Xe={class:"p-5"},Ke={class:"mr-auto text-base font-medium"},We={class:"col-span-12 sm:col-span-12"},Ze={class:"col-span-12 sm:col-span-6"},Je=["value"],et={class:"col-span-12 sm:col-span-6"},tt={class:"relative w-30 mx-auto"},at={class:"absolute flex items-center justify-center w-10 h-full border rounded-l bg-slate-100 text-slate-500 dark:bg-darkmode-700 dark:border-darkmode-800 dark:text-slate-400"},st={class:"col-span-12 sm:col-span-6"},ot={class:"col-span-12 sm:col-span-6"},lt=["value"],nt={class:"col-span-12 sm:col-span-12"},rt={class:"col-span-12 sm:col-span-6"},dt=["value"],it={class:"col-span-12 sm:col-span-6"},ut=["value"],ct={class:"col-span-12 sm:col-span-12"},_t={class:"text-center"},mt={class:"p-5"},pt=d("h2",{class:"mr-auto text-base font-medium"}," File Documents ",-1),ft={class:"col-span-12 intro-y lg:col-span-12"},vt={class:"flex items-center"},gt={class:"ml-4"},ht={class:"font-medium",href:""},bt={class:"text-slate-500 text-xs mt-0.5"},wt={class:"p-5 text-center"},yt=d("div",{class:"mt-5 text-3xl"},"Are you sure to delete ?",-1),kt={class:"mt-2 text-slate-500"},xt={class:"px-5 pb-8 text-center"},qt={class:"ml-4 mr-4"},Ct={class:"font-medium"},Dt=Se({__name:"RegisterQuote",setup(l){const r=g(),c=()=>{var i;(i=r.value)==null||i.showToast()};Fe("bind[basicStickyNotification]",i=>{r.value=i});const b=g(!1),$=i=>{b.value=i},oe=g(null),le=De(),m=Pe(),ne=Ve(),s=ue({}),M=ue({}),I=g("0"),B=g("0"),T=g("0"),F=g("0"),Q=g(""),R=g(""),H=g("");g(null);const G=g(!1),ae=g(!1),U=i=>{O(),G.value=i},ce=i=>{G.value=i},N=i=>{ae.value=i};$e(async()=>{O(),await m.ItemsList(),await m.somnong_client(),await m.somnong_status(),await m.somnong_leader(),await le.getComboProvince()});const _e=S(()=>le.getProvince),me=S(()=>m.getClients),pe=S(()=>m.getStatus),fe=S(()=>m.getLeader),f=S(()=>m.getItemsById),ve=S(()=>m.getItemsDetail);function re(i=new Date){return i.setDate(i.getDate()+1),i}const de=S(()=>m.getQuote_File);j(T,()=>{s.quote_leader=T.value}),j(B,()=>{s.quote_status=B.value}),j(H,()=>{const i=new Date(H.value);s.tranDate=re(i)}),j(I,()=>{s.client_id=I.value}),j(F,()=>{s.address_code=F.value});async function ie(i){s.quote_code=i,m.quote_file_view(i),N(!0)}async function ge(i){O(),await m.ItemsById(i),s.status="u",s.client_id=f.value[0].client_id,s.quote_code=f.value[0].quote_code,s.client_name=f.value[0].client_name,s.quote_title=f.value[0].quote_title,s.house_number=f.value[0].house_number,s.phone=f.value[0].phone,s.quote_status=f.value[0].quote_status,s.google_map=f.value[0].google_map,s.remark=f.value[0].remark,F.value=f.value[0].address_code,I.value=f.value[0].client_id,B.value=f.value[0].status_code,T.value=f.value[0].leader_code,s.tranDate=f.value[0].tranDate,s.is_update=f.value[0].is_update,ce(!0)}function O(){s.branch_code="",s.quote_title="",s.client_id="",s.client_name="",s.quote_leader="",s.quote_status="",s.house_number="",s.cost=0,s.address="",s.google_map="",s.remark="",s.active=!0,s.status="i",T.value="",B.value="",I.value="",F.value="",w.value.$reset(),s.is_update=!0;const i=new Date(Ie.exports.now());s.tranDate=re(i)}const he=S(()=>({quote_title:{required:Z.withMessage("Quote status is required",J),minLength:ee(1)},client_id:{required:Z.withMessage("Client information is required",J),minLength:ee(3)},quote_status:{required:Z.withMessage("Quote status is required",J),minLength:ee(1)},quote_leader:{required:Z.withMessage("Phone is required",J),minLength:ee(1)}})),w=Be(he,s,{$autoDirty:!0});async function be(){if(w.value.$touch(),w.value.$invalid)Q.value=w.value.$errors[0].$message,R.value="error",c();else{var i=await m.create(s);i&&(R.value="",s.status=="i"?Q.value=ne.getInsert:Q.value=ne.getUpdate,c(),U(!1),O(),await m.ItemsList())}}const Y=g([]),we=()=>Y.value=[],ye=i=>{const n=i.target;n.files!==null&&(we(),Array.from(n.files).forEach(o=>{Y.value.push({referent_id:s.quote_code,file:o,percentage:0,status:"pending",size:o.size})}),Y.value[0].size>5e5?(Q.value="File bigger than 2MB !!!",R.value="error",c()):Y.value.forEach(o=>{o.status="uploading",o.percentage=0,m.upload_image(o.file,s.quote_code)}))};async function ke(i){M.file_code=i}async function xe(i){}async function qe(i){M.status="del_quote_file",M.quote_code=s.quote_code;var n=await m.del_quote_file(M);n&&(N(!1),$(!1),ie(s.quote_code))}return(i,n)=>(_(),y("div",Me,[d("div",Qe,[t(e(D),{variant:"primary",class:"mr-2 shadow-md",onClick:n[0]||(n[0]=()=>{U(!0)})},{default:a(()=>[u(" Create New ")]),_:1}),Ue,d("div",Ne,[d("div",je,[t(e(A),{type:"text",class:"w-56 pr-10 !box",placeholder:"Search..."}),t(e(k),{icon:"Search",class:"absolute inset-y-0 right-0 w-4 h-4 my-auto mr-3"})])])]),d("div",Ae,[t(e(v),{class:"border-spacing-y-[10px] border-separate -mt-2"},{default:a(()=>[t(e(v).Thead,null,{default:a(()=>[t(e(v).Tr,null,{default:a(()=>[t(e(v).Th,{class:"border-b-0 whitespace-nowrap"},{default:a(()=>[u(" Client Name ")]),_:1}),t(e(v).Th,{class:"border-b-0 whitespace-nowrap"},{default:a(()=>[u(" Quote ")]),_:1}),t(e(v).Th,{class:"border-b-0 whitespace-nowrap"},{default:a(()=>[u(" Phone ")]),_:1}),t(e(v).Th,{class:"text-center border-b-0 whitespace-nowrap"},{default:a(()=>[u(" Status ")]),_:1}),t(e(v).Th,{class:"text-center border-b-0 whitespace-nowrap"},{default:a(()=>[u(" Action ")]),_:1})]),_:1})]),_:1}),t(e(v).Tbody,null,{default:a(()=>[(_(!0),y(L,null,P(ve.value,o=>(_(),V(e(v).Tr,{key:o.quote_code,class:"intro-x"},{default:a(()=>[t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b]"},{default:a(()=>[d("a",ze,h(o.client_name),1),d("div",Re," id: "+h(o.quote_code),1)]),_:2},1024),t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b]"},{default:a(()=>[u(h(o.quote_title),1)]),_:2},1024),t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b]"},{default:a(()=>[u(h(o.phone),1)]),_:2},1024),t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b]"},{default:a(()=>[u(h(o.quote_status),1)]),_:2},1024),t(e(v).Td,{class:"first:rounded-l-md last:rounded-r-md w-56 bg-white border-b-0 dark:bg-darkmode-600 shadow-[20px_3px_20px_#0000000b] py-0 relative before:block before:w-px before:h-8 before:bg-slate-200 before:absolute before:left-0 before:inset-y-0 before:my-auto before:dark:bg-darkmode-400"},{default:a(()=>[d("div",He,[d("a",{class:"flex items-center mr-3",href:"",onClick:E=>{E.preventDefault(),ge(o.quote_code)}},[t(e(k),{icon:"Edit",class:"w-4 h-4 mr-1"}),u(" Edit ")],8,Ge),d("a",{class:"flex items-center mr-3",href:"",onClick:E=>{E.preventDefault(),ie(o.quote_code)}},[t(e(k),{icon:"Settings",color:"red",class:"w-4 h-4 mr-1"}),u(" File ")],8,Oe)])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),t(e(p),{staticBackdrop:"",open:G.value,onClose:n[13]||(n[13]=()=>{U(!1)})},{default:a(()=>[t(e(p).Panel,{class:"px-5 py-10"},{default:a(()=>[d("div",Ye,[t(e(X),{class:"mt-5 intro-y box"},{default:a(()=>[d("div",Xe,[t(e(X).Panel,null,{default:a(()=>[t(e(p),{staticBackdrop:"",open:G.value,onClose:n[12]||(n[12]=()=>{U(!1)})},{default:a(()=>[t(e(p).Panel,null,{default:a(()=>[t(e(p).Title,null,{default:a(()=>[d("h2",Ke," Project Information "+h(s.quote_code?" : "+s.quote_code:""),1)]),_:1}),t(e(p).Description,{class:"grid grid-cols-12 gap-4 gap-y-3"},{default:a(()=>[d("div",We,[t(e(C),{htmlFor:"modal-form-1"},{default:a(()=>[u("Title")]),_:1}),t(e(A),{value:s.quote_title,type:"text",placeholder:"project title",modelValue:s.quote_title,"onUpdate:modelValue":n[1]||(n[1]=o=>s.quote_title=o),error:e(w).quote_title.$error,class:K({"border-danger":e(w).quote_title.$error}),disabled:!s.is_update},null,8,["value","modelValue","error","class","disabled"])]),d("div",Ze,[t(e(C),{htmlFor:"modal-form-1"},{default:a(()=>[u("Client")]),_:1}),t(e(W),{name:"cboClient",modelValue:I.value,"onUpdate:modelValue":n[2]||(n[2]=o=>I.value=o),error:e(w).client_id.$error,disabled:!s.is_update,class:K({"border-danger":e(w).client_id.$error})},{default:a(()=>[(_(!0),y(L,null,P(me.value,o=>(_(),y("option",{value:o.id,key:o.id},h(o.name),9,Je))),128))]),_:1},8,["modelValue","error","disabled","class"])]),d("div",et,[t(e(C),{htmlFor:"modal-form-4"},{default:a(()=>[u("Date")]),_:1}),d("div",tt,[d("div",at,[t(e(k),{icon:"Calendar",class:"w-4 h-4"})]),t(e(Te),{modelValue:H.value,"onUpdate:modelValue":n[3]||(n[3]=o=>H.value=o),options:{autoApply:!0,showWeekNumbers:!0,dropdowns:{minYear:2020,maxYear:null,months:!0,years:!0}},value:s.tranDate,class:"pl-12",disabled:!s.is_update},null,8,["modelValue","value","disabled"])])]),d("div",st,[t(e(C),{htmlFor:"modal-form-4"},{default:a(()=>[u("House number ")]),_:1}),t(e(A),{type:"text",value:s.house_number,placeholder:"House number",disabled:!s.is_update,modelValue:s.house_number,"onUpdate:modelValue":n[4]||(n[4]=o=>s.house_number=o)},null,8,["value","disabled","modelValue"])]),d("div",ot,[t(e(C),{htmlFor:"modal-form-6"},{default:a(()=>[u("Address")]),_:1}),t(e(W),{name:"cboAddress",modelValue:F.value,"onUpdate:modelValue":n[5]||(n[5]=o=>F.value=o),value:F.value,disabled:!s.is_update},{default:a(()=>[(_(!0),y(L,null,P(_e.value,o=>(_(),y("option",{value:o.id,key:o.id},h(o.name),9,lt))),128))]),_:1},8,["modelValue","value","disabled"])]),d("div",nt,[t(e(C),{htmlFor:"modal-form-4"},{default:a(()=>[u(" Link Google Map ")]),_:1}),t(e(A),{type:"text",value:s.google_map,placeholder:"Google Map",modelValue:s.google_map,"onUpdate:modelValue":n[6]||(n[6]=o=>s.google_map=o)},null,8,["value","modelValue"])]),d("div",rt,[t(e(C),{htmlFor:"modal-form-1"},{default:a(()=>[u("Status")]),_:1}),t(e(W),{name:"cboStatus",modelValue:B.value,"onUpdate:modelValue":n[7]||(n[7]=o=>B.value=o),error:e(w).quote_status.$error,class:K({"border-danger":e(w).quote_status.$error})},{default:a(()=>[(_(!0),y(L,null,P(pe.value,o=>(_(),y("option",{value:o.id,key:o.id},h(o.name),9,dt))),128))]),_:1},8,["modelValue","error","class"])]),d("div",it,[t(e(C),{htmlFor:"modal-form-1"},{default:a(()=>[u("Lead by")]),_:1}),t(e(W),{name:"cboLeader",modelValue:T.value,"onUpdate:modelValue":n[8]||(n[8]=o=>T.value=o),error:e(w).quote_leader.$error,class:K({"border-danger":e(w).quote_leader.$error})},{default:a(()=>[(_(!0),y(L,null,P(fe.value,o=>(_(),y("option",{value:o.id,key:o.id},h(o.name),9,ut))),128))]),_:1},8,["modelValue","error","class"])]),d("div",ct,[t(e(C),{htmlFor:"remark"},{default:a(()=>[u(" Remark ")]),_:1}),t(e(Ee),{modelValue:s.remark,"onUpdate:modelValue":n[9]||(n[9]=o=>s.remark=o),value:s.remark,placeholder:"type your comment"},null,8,["modelValue","value"])])]),_:1}),t(e(p).Footer,null,{default:a(()=>[t(e(D),{type:"button",variant:"outline-secondary",onClick:n[10]||(n[10]=()=>{U(!1)}),class:"w-20 mr-1"},{default:a(()=>[u(" Cancel ")]),_:1}),t(e(D),{name:"btnOk",variant:"primary",type:"button",class:"w-20",ref:"{sendButtonRef}",disable:e(w).$invalid,onClick:n[11]||(n[11]=o=>be())},{default:a(()=>[u(" Commit ")]),_:1},8,["disable"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})])]),_:1})])]),_:1})]),_:1},8,["open"]),t(e(p),{staticBackdrop:"",open:ae.value,onClose:n[16]||(n[16]=()=>{N(!1)})},{default:a(()=>[t(e(p).Panel,{class:"px-5 py-10"},{default:a(()=>[d("div",_t,[t(e(X),{class:"mt-5 intro-y box"},{default:a(()=>[d("div",mt,[t(e(X).Panel,null,{default:a(()=>[t(e(p),{staticBackdrop:"",open:ae.value,onClose:n[15]||(n[15]=()=>{N(!1)})},{default:a(()=>[t(e(p).Panel,null,{default:a(()=>[t(e(p).Title,null,{default:a(()=>[pt]),_:1}),t(e(p).Description,{class:"grid grid-cols-12 gap-4 gap-y-3"},{default:a(()=>[(_(!0),y(L,null,P(de.value,o=>(_(),y("div",ft,[d("div",vt,[o.extension==".png"?(_(),V(e(te),{key:0,class:"w-12 file",variant:"directory"})):o.extension==".pdf"?(_(),V(e(te),{key:1,class:"w-12 file",variant:"file"})):o.extension==".jpg"?(_(),V(e(te),{key:2,class:"w-12 file",variant:"directory"})):(_(),V(e(te),{key:3,class:"w-12 file",variant:"directory"})),d("div",gt,[d("a",ht,h(o.file_name),1),d("div",bt,h(o.extension),1)]),t(e(z),{class:"ml-auto"},{default:a(()=>[t(e(z).Button,{tag:"a",class:"block w-5 h-5",href:"#"},{default:a(()=>[t(e(k),{icon:"MoreHorizontal",class:"w-5 h-5 text-slate-500"})]),_:1}),t(e(z).Items,{class:"w-40"},{default:a(()=>[t(e(z).Item,{onClick:E=>xe(o.file_name)},{default:a(()=>[t(e(k),{icon:"Files",class:"w-4 h-4 mr-2"}),u(" View File ")]),_:2},1032,["onClick"]),t(e(z).Item,{variant:"primary",onClick:E=>{E.preventDefault(),$(!0),ke(o.row)}},{default:a(()=>[t(e(k),{icon:"Trash",class:"w-4 h-4 mr-2 red",color:"red"}),u(" Delete ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)])]))),256))]),_:1}),t(e(p).Footer,null,{default:a(()=>[t(e(D),{type:"button",variant:"outline-secondary",onClick:n[14]||(n[14]=()=>{N(!1)}),class:"mr-1"},{default:a(()=>[t(e(k),{icon:"Save",class:"w-4 h-4 mr-4"}),u(" Close ")]),_:1}),t(e(D),{variant:"primary",type:"button",accept:"image/png, image/jpeg"},{default:a(()=>[t(e(k),{icon:"File",class:"w-4 h-4 mr-4"}),u(" Upload "),t(e(A),{type:"file",class:"absolute right-8 w-20 h-10 opacity-0",accept:"image/png, image/jpeg",onChange:ye})]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})])]),_:1})])]),_:1})]),_:1},8,["open"]),t(e(p),{open:b.value,onClose:n[19]||(n[19]=()=>{$(!1)}),initialFocus:oe.value},{default:a(()=>[t(e(p).Panel,null,{default:a(()=>[d("div",wt,[t(e(k),{icon:"XCircle",class:"w-16 h-16 mx-auto mt-3 text-danger"}),yt,d("div",kt," document : "+h(M.file_code),1)]),d("div",xt,[t(e(D),{type:"button",variant:"outline-secondary",onClick:n[17]||(n[17]=()=>{$(!1)}),class:"w-24 mr-1"},{default:a(()=>[u(" Cancel ")]),_:1}),t(e(D),{type:"button",variant:"danger",class:"w-24",ref:"{deleteButtonRef}",onClick:n[18]||(n[18]=o=>{o.preventDefault(),qe(de.value[0].tran_code)})},{default:a(()=>[u(" Delete ")]),_:1},512)])]),_:1})]),_:1},8,["open","initialFocus"]),t(e(Le),{refKey:"basicStickyNotification",options:{duration:1500},class:"flex hidden"},{default:a(()=>[R.value=="error"?(_(),V(e(k),{key:0,icon:"XCircle",class:"text-danger"})):(_(),V(e(k),{key:1,icon:"CheckCircle",class:"text-success"})),d("div",qt,[d("div",Ct,h(Q.value),1)])]),_:1})]))}});export{Dt as default};
